<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <script
      src="https://kit.fontawesome.com/c25aa32a21.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
      integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-1.12.0.min.js"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/styles/atom-one-dark.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Group 14</title>
  </head>
  <body>
    <!--Navbar-->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark py-3">
      <div class="container">
        <img
          width="150"
          src="img\Picture2.png"
          class="d-inline-block align-middle mr-2"
        />
        <a href="#" class="navbar-brand">VeloCity</a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navmenu"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navmenu">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a href="/index.html" class="nav-link">Home</a>
            </li>
            <li class="nav-item">
              <a href="/lit.html" class="nav-link">Research</a>
            </li>
            <li class="nav-item">
              <a href="/hci.html" class="nav-link">HCi</a>
            </li>
            <li class="nav-item">
              <a href="/requirements.html" class="nav-link">Requirements</a>
            </li>
            <li class="nav-item">
              <a href="/implementation.html" class="nav-link">Implementation</a>
            </li>
            <li class="nav-item">
              <a href="/requirements.html" class="nav-link">Requirements</a>
            </li>
            <li class="nav-item">
              <a href="/ui.html" class="nav-link">Sys.Design</a>
            </li>
            <li class="nav-item">
              <a href="/system.html" class="nav-link">UI Design</a>
            </li>
            <li class="nav-item">
              <a href="/evaluation.html" class="nav-link">Testing</a>
            </li>
            <li class="nav-item">
              <a href="/appendix.html" class="nav-link">Appendix</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!--Showcase-->
    <section class="bg-dark text-light p-2 text-center text-sm-start">
      <div class="container">
        <div class="d-sm-flex align-items-center justify-content-between">
          <div>
            <h1>Implementation</h1>
          </div>
          <img
            class="img-fluid w-50 ms-auto d-none d-sm-block"
            src="img/undraw_personal_trainer_re_cnua.svg"
            alt=""
          />
        </div>
      </div>
    </section>

    <section>
      <div class="container aos-init aos animate" data-aos="fade-up">
        <div class="row justify-content-center mb-4">
          <h4><br /><br /><b>Main technologies</b></h4>
          <p class="lead">
            As described in our 'Research' page, our main technologies are
            <span class="m-head"><b>Xamarin</b></span
            >,<span class="m-head"><b> .NET MAUI</b></span> and<span
              class="m-head"
              ><b> C#</b></span
            >
          </p>

          <div class="row">
            <div class="d-flex justify-content-center">
              <img
                src="img/png-transparent-xamarin-mobile-app-development-native-net-framework-c-android-blue-angle-calendar-removebg-preview.png"
                class="tech"
              />
              <img src="img/shadow-removebg-preview.png" class="tech" />
              <img src="img/Csharp_Logo.png" class="tech" />
              <img
                src="img/radial-icon-set-2-bluetooth-bluetooth-icon-png-clipart-thumbnail-removebg-preview.png"
                class="tech"
              />
            </div>
          </div>
          <h4><br /><br />Dependencies & Tools</h4>
          <p class="lead">
            We also imported some plugins & dependencies in our project to help
            us test & build our project
          </p>
        </div>
      </div>
    </section>

    <section id="learn" class="p-5">
      <div class="container aos-init aos-animate" data-aos="fade-up">
        <div class="row justify-content-center mb-4">
          <div class="v-tab">
            <div class="v-content">
              <input type="radio" name="slider" checked id="home" />
              <input type="radio" name="slider" id="blog" />
              <input type="radio" name="slider" id="help" />
              <input type="radio" name="slider" id="code" />
              <div class="list">
                <label for="home" class="home">
                  <span class="title">Plugin.BLE</span>
                </label>
                <label for="blog" class="blog">
                  <span class="title">Tool.Maui</span>
                </label>
                <label for="help" class="help">
                  <span class="title">Tool.Mvvm</span>
                </label>
                <label for="code" class="code">
                  <span class="title">Syncfusion</span>
                </label>
                <div class="slider"></div>
              </div>
              <div class="text-content">
                <div class="home text">
                  <h5><b>Plugin.BLE</b></h5>
                  <p class="lead">
                    Given that the .NET MAUI framework does not offer in-built
                    bluetooth libraries, we had to rely and a community driven
                    plugin called <span class="m-head">Plugin.BLE</span> which
                    provided us with a reilable way to communicate with
                    Bluetooth Low Energy (BLE) devices - in our case, sensors.
                    It gave us the ability to scan, discover and connect to BLE
                    devices whilst also being able to read their
                    characteristics. In our case, we used it to discover heart
                    and cadence sensors and read their information during a
                    workout.
                    <br />
                    <br />
                  </p>
                </div>
                <div class="blog text">
                  <h5><b>CommunityToolkit.Maui</b></h5>
                  <p class="lead">
                    A plugin that offers a range of benefits to developing
                    cross-platform applications using .NET MAUI. It enables
                    greater control over handling data input, validation,
                    dialogs and animation. Furthermore, it also provides
                    platform-specific implementations and code which is helpful
                    to our project given the current scope of the app is for
                    Android devices only.
                  </p>
                </div>
                <div class="help text">
                  <h5><b>CommunityToolkit.Mvvm</b></h5>

                  <p class="lead">
                    Offers an implementation of the Model-View-ViewModel(MVVM)
                    architecture which helps separate concerns thus promoting
                    industry software engineering standards. It helps create
                    maintanable testable and scalable code whilst providing a
                    range of utilities for creating and binding to Viewmodel
                    classes which was primarily used in the sensor integration
                    development given several models were required to build a
                    functioning bluetooth system. With the plugin, it provides
                    more structure to an otherwise unstructured codebase.
                  </p>
                </div>
                <div class="code text">
                  <h5><b>Syncfusion</b></h5>

                  <p class="lead">
                    Enables the use of data visualization. The plugin offers a
                    range of chart types, in our instance we primarily use line
                    graphs to show how sensor data alternates throughout a
                    workout. The charts are customizable allowing us to adjust
                    the fonts, colors and markers.
                  </p>
                </div>
              </div>
            </div>
          </div>
          <br />
          <br />
        </div>
      </div>
    </section>

    <section class="p-5">
      <div class="container aos-init aos-animate" data-aos="fade-up">
        <div class="row justify-content-center mb-4">
          <h3 class="text-center"><br />Overview of the Process</h3>
          <p class="lead">
            We will explore how our accessibility-first fitness tracking app was
            designed and developed to its completion. The process will be broken
            down and explained in multiple segments for better understanding and
            overall comprehension of the numerous aspects involved in the app’s
            final design and implementation. During the development, to
            guarantee smooth progression, we established a set of technical
            objectives to complete, which implementation we will cover more
            in-depth in the following sections.
          </p>
          <figure class="figure">
            <img
              src="/img/System_Architecture_(2).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              System Architecture Diagram
            </figcaption>
            <br />
            <br />
          </figure>
          <figure class="figure">
            <img
              src="/img/Untitled (1).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Overview of the main process
            </figcaption>
            <br />
            <br />
          </figure>
          <h4>
            <b><br />Tools and Dependencies</b>
          </h4>
          <div class="row">
            <div class="d-flex justify-content-center">
              <img
                src="img/png-transparent-xamarin-mobile-app-development-native-net-framework-c-android-blue-angle-calendar-removebg-preview.png"
                class="tech"
              />
              <img src="img/shadow-removebg-preview.png" class="tech" />
              <img src="img/Csharp_Logo.png" class="tech" />

              <img
                src="img/android-icon-logo-DB06FA8B39-seeklogo.com-removebg-preview.png"
                class="tech"
              />
            </div>
          </div>

          <h4>
            <b><br />Workouts</b>
          </h4>
          <p class="lead">
            Workouts are the most important aspect of our app, they are core
            structure which allows users to name their future exercises, record
            their activity type, intent, date and much more. They are versatile,
            yet stable and easy to use. They are represented as objects,
            adhering to the structure of the Workout class, which classifies as
            a Model in our system architecture diagram.
          </p>
          <figure class="figure">
            <img
              src="/img/Untitled 1 (1).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Workout class classification in the system architecture diagram
            </figcaption>
            <br />
            <br />
          </figure>
          <pre><code>
                    namespace Project_VeloCity.Models;
                    internal class Workout
                    {
                        public static List&lt;string&gt; ActivityTypes =
                            new()
                            { &quot;Basketball&quot;, &quot;Table Tennis&quot;, &quot;Swimming&quot;, &quot;Cycling&quot;};
                        public static List&lt;string&gt; TrainingIntents =
                            new()
                            { &quot;Indoor&quot;, &quot;Outdoor&quot;};
                        public string Filename { get; set; }
                        public DateTime Date { get; set; }
                        public string Name { get; set; }
                        public string ActivityType { get; set; }
                        public string TrainingIntent { get; set; }
                        </code></pre>
          <p class="lead">
            The Workout class consists of two public static properties which are
            lists of activity types and training intents users can choose from.
            But the main reason for this implementation was to allow for
            accessibility-first multi-option buttons users interact with when
            creating or editing a workout. Next sections will describe specific
            implementation of core actions with different types of workouts
            within the app.
          </p>
          <h4>
            <b
              ><br />
              New workouts</b
            >
          </h4>
          <h5>
            <b><br />Creating New Workouts For Fast (Re)use</b>
          </h5>
          <p class="lead">
            Seamless creation of a new workout. The user just needs to set the
            workout name. select activity type and training intent using two
            universally-accessible multi-option buttons with Text-To-Speech
            integration. In this section we will talk about how this is actually
            implemented from the developer point of view. We had to define a
            HomePage XAML file and its corresponding code behind, which upon
            generating UI components allow the user to navigate to screen for
            creating new workout.
          </p>
          <pre><code>
            &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.HomePage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Welcome&quot;&gt;

		&lt;!-- REST OF THE CODE --&gt;

        &lt;Button
            Grid.Row=&quot;1&quot;
            BorderWidth=&quot;2&quot;
            Clicked=&quot;NewWorkout_Clicked&quot;
            CornerRadius=&quot;50&quot; /&gt;

				&lt;Label
            Grid.Row=&quot;1&quot;
            Margin=&quot;0,190,0,0&quot;
            FontSize=&quot;32&quot;
            HorizontalOptions=&quot;Center&quot;
            Text=&quot;New Workout&quot; /&gt;

        &lt;Image
            Grid.Row=&quot;1&quot;
            Margin=&quot;50&quot;
            HeightRequest=&quot;120&quot;
            HorizontalOptions=&quot;Center&quot;
            Source=&quot;new_workout.png&quot;
            VerticalOptions=&quot;Start&quot;
            WidthRequest=&quot;120&quot; /&gt;

		&lt;!-- REST OF THE CODE --&gt;

&lt;/ContentPage&gt;
          </code></pre>
          <br />
          <pre><code>
namespace Project_VeloCity.Views;

public partial class HomePage : ContentPage
{
	public HomePage()
	{
		InitializeComponent();
	}

		// REST OF THE CODE
		
    private async void NewWorkout_Clicked(object sender, EventArgs e)
    {
		await Shell.Current.GoToAsync(nameof(EditWorkoutPage));
    }

    // REST OF THE CODE
}
          </code></pre>
          <p class="lead">
            Upon pressing the New Workout button, XAML will trigger the
            corresponding method in the code behind, which will navigate to the
            registered EditWorkoutPage. The aforementioned page has the form for
            creating a new workout. Having a single page for both editing and
            creating workouts leads to much less redundant code and greater
            readability of the repository. The sequence diagram and its
            corresponding wireframe describe the process background but also
            foreground, respectively.
          </p>
          <figure class="figure">
            <img
              src="/img/Creating_New_Workout_(3).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Sequence diagram for Creating New Workouts For Fast (Re)use
            </figcaption>
            <br />
            <br />
          </figure>
          <figure class="figure">
            <img
              src="/img/Untitled 2 (1).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              User-flow For Creating New Workouts
            </figcaption>
            <br />
            <br />
          </figure>
          <p class="lead">
            The ease-of-use lies in having only two pathways forward from this
            point in navigation, either saving the workout for later use, or
            following the stream-lined navigation pattern and starting the
            workout, which will be automatically saved in the process.
            Therefore, we have chosen to separately describe the two processes
            starting with explaining the implementation of the first one, saving
            new workout.
          </p>
          <h5><br /><b>Accessibility-First Multi-Option Buttons</b></h5>
          <p class="lead">
            These are the aforementioned buttons users interact with when
            creating or editing a workout. They allow for accessible choosing of
            activity type and workout intent, allowing both individuals
            blindness and visual impairments to use them with ease. Instead of
            searching the list of options in the pop-up windows, we encapsulated
            the process in a simple click of a button. Upon each click the next
            activity type or training intent is chosen and presented to the
            user. Memorising the number of clicks rather than the specific
            position on the screen when creating workouts is something is
            undoubtedly much easier and comprehensive for not only disabled but
            also for non-disabled users. It has been implemented through
            iteration of the static lists of workout types and training intents
            from the Workout class, which we have shown in its corresponding
            section.
          </p>
          <figure class="figure">
            <img
              src="/img/activitytype.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Part of the Sequence diagram for Creating New Workouts For Fast
              (Re)use corresponding to Activity type Multi-Option button
            </figcaption>
            <br />
            <br />
          </figure>
          <pre><code>
            &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.HomePage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Welcome&quot;&gt;

		&lt;!-- REST OF THE CODE --&gt;

        &lt;Button
            Grid.Row=&quot;1&quot;
            BorderWidth=&quot;2&quot;
            Clicked=&quot;NewWorkout_Clicked&quot;
            CornerRadius=&quot;50&quot; /&gt;

				&lt;Label
            Grid.Row=&quot;1&quot;
            Margin=&quot;0,190,0,0&quot;
            FontSize=&quot;32&quot;
            HorizontalOptions=&quot;Center&quot;
            Text=&quot;New Workout&quot; /&gt;

        &lt;Image
            Grid.Row=&quot;1&quot;
            Margin=&quot;50&quot;
            HeightRequest=&quot;120&quot;
            HorizontalOptions=&quot;Center&quot;
            Source=&quot;new_workout.png&quot;
            VerticalOptions=&quot;Start&quot;
            WidthRequest=&quot;120&quot; /&gt;

		&lt;!-- REST OF THE CODE --&gt;

&lt;/ContentPage&gt;
          </code></pre>
          <pre><code>
using Microsoft.Maui;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class EditWorkoutPage : ContentPage
{

// REST OF THE CODE

    private async void ActivityTypeButton_Clicked(object sender, EventArgs e)
    {
        if (BindingContext is Models.Workout workout)
        {
            if (workout.ActivityType == &quot;Activity&quot;)
            {
                workout.ActivityType = Models.Workout.ActivityTypes[0];
            }
            else
            {
                workout.ActivityType =
                    Models.Workout.ActivityTypes[
                        (Models.Workout.ActivityTypes.IndexOf(
                            workout.ActivityType
                            ) + 1) % Models.Workout.ActivityTypes.Count
                        ];
            }
            ActivityButton.Text = workout.ActivityType;
            await TextToSpeech.SpeakAsync(workout.ActivityType);
        }
    }

// REST OF THE CODE

}
          </code></pre>
          <h5>
            <b><br />Saving New Workout</b>
          </h5>
          <p class="lead">
            In the case the user wants to setup the workouts prior to the
            exercise, it can seamlessly saved them by a click of a button. What
            happens in the background is once again triggering of a button, but
            this time saving the file in the app data directory with extension
            “.workout.txt”, giving us the ability to fetch all the workout files
            and use them repeatedly when needed.
          </p>
          <pre><code>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.EditWorkoutPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Setup Workout&quot;&gt;

		&lt;!-- REST OF THE CODE --&gt;

                &lt;Button
                    Grid.Column=&quot;0&quot;
                    BackgroundColor=&quot;{StaticResource Primary}&quot;
                    BorderWidth=&quot;2&quot;
                    Clicked=&quot;SaveButton_Clicked&quot;
                    CornerRadius=&quot;50&quot;
                    FontSize=&quot;32&quot;
                    Text=&quot;Save&quot;
                    TextColor=&quot;White&quot; /&gt;

		&lt;!-- REST OF THE CODE --&gt;

&lt;/ContentPage&gt;
          </code></pre>

          <pre><code>
using Microsoft.Maui;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class EditWorkoutPage : ContentPage
{

// REST OF THE CODE

private async void SaveButton_Clicked(object sender, EventArgs e)
    {
        if (BindingContext is Models.Workout workout)
        {
            File.WriteAllText(
                workout.Filename, $"{workout.Name},{workout.ActivityType},{workout.TrainingIntent}"
                );
        }
        await Shell.Current.GoToAsync("..");
    }

// REST OF THE CODE

}
          </code></pre>
          <p class="lead">
            Upon pressing the save button, the XAML triggers the associated
            method for file system management. It checks whether the current
            binding context is of the workout type and writes it into a file in
            a CSV format to allow for future use and straightforward
            deserialization. In order to create a new workout and save it in
            such a simple way, we had to abstract the complexity to other
            methods in the class. Therefore upon getting to the EditWorkoutPage
            itself we had to first preload the empty workout and set the binding
            context in the following way:
          </p>
          <pre><code>
            using Microsoft.Maui;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class EditWorkoutPage : ContentPage
{
		private string workoutFilename;

    public EditWorkoutPage()
    {
        InitializeComponent();

        string appDataPath = FileSystem.AppDataDirectory;
        string randomFileName = $&quot;{Path.GetRandomFileName()}.workout.txt&quot;;
        LoadWorkout(Path.Combine(appDataPath, randomFileName));

    }

// REST OF THE CODE

private void LoadWorkout(string fileName)
    {
        Models.Workout workout = new Models.Workout();
        workout.Filename = fileName;
        workoutFilename = fileName;

        if (File.Exists(fileName))
        {
            string[] elements = File.ReadAllText(fileName).Split(',');
            workout.Name = elements[0];
            workout.ActivityType = elements[1];
            workout.TrainingIntent = elements[2];
            workout.Date = File.GetCreationTime(fileName);
        }
				
        if (workout.ActivityType == &quot;&quot; || workout.ActivityType == null)
        {
            workout.ActivityType = &quot;Activity&quot;;
        }

        if (workout.TrainingIntent == &quot;&quot; || workout.TrainingIntent == null)
        {
            workout.TrainingIntent = &quot;Intent&quot;;
        }

        BindingContext = workout;

    }

// REST OF THE CODE

}
          </code></pre>
          <p class="lead">
            In order to better understand its overall architecture, we have
            created the sequence diagram which describes the process with
            respect to time. It is followed by the user’s point of view, where
            the only form of interaction needed is a simple press of a button.
          </p>
          <figure class="figure">
            <img
              src="/img/Saving_New_Workout (1).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Sequence Diagram For Saving New Workouts
            </figcaption>
            <br />
            <br />
          </figure>
          <figure class="figure">
            <img
              src="/img/Untitled 3.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              User-flow for Saving New Workout
            </figcaption>
            <br />
            <br />
          </figure>
          <h5><br /><b>Starting New Workout</b></h5>
          <p class="lead">
            Streamlined navigation design allowed for a single-path approach to
            initiating workouts. User only needs to follow the path of bright
            buttons and it will get the app into its desired state. The sequence
            consists of confirming selected workout name, activity type and
            training intent, before checking connected sensors and commencing to
            the active workout screen itself, where the user begins the exercise
            related to the chosen workout.
          </p>
          <div class="row">
            <div class="d-flex justify-content-center">
              <figure class="figure">
                <img
                  src="/img/Untitled 4.png"
                  class="figure-img img-fluid rounded"
                />
                <figcaption class="figure-caption text-center">
                  Sequence Diagram For Starting New Workout
                </figcaption>
                <br />
                <br />
              </figure>
            </div>
          </div>
          <p class="lead">
            What happens in the background is actually stack based approach,
            where new pages are added on top of each other, making it easier to
            revert back but also making the navigation stream-lined and
            connected to the same root. We start from EditWorkoutPage XAML file
            and its code behind, which upon the button trigger adds the
            SensorConnectionPage on top of the stack. XAML file of newly added
            page compiles and produces the UI elements visible to the user in
            the form of state of the connections with the Bluetooth sensors.
            Once that’s confirmed by the user, the next button gets initiated
            and the ActiveWorkoutPage sets up the UI environment for finally
            initiating the workout exercise. We will show how this is
            implemented in order from the beginning of the sequence to the end.
            Notable feature for our users is that by pressing next, the workout
            gets automatically saved, eliminating the need for repetitive
            user-flow patterns.
          </p>
          <h6><br /><b>Commencing from EditWorkoutPage:</b></h6>
          <pre><code>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.EditWorkoutPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Setup Workout&quot;&gt;

		&lt;!-- REST OF THE CODE --&gt;

								&lt;Button
                    Grid.Column=&quot;1&quot;
                    BackgroundColor=&quot;{StaticResource Secondary}&quot;
                    BorderWidth=&quot;2&quot;
                    Clicked=&quot;NextEditWorkout_Clicked&quot;
                    CornerRadius=&quot;50&quot;
                    FontAttributes=&quot;Bold&quot;
                    FontSize=&quot;32&quot;
                    Text=&quot;Next&quot;
                    TextColor=&quot;{StaticResource Primary}&quot; /&gt;

		&lt;!-- REST OF THE CODE --&gt;
&lt;/ContentPage&gt;

}
          </code></pre>

          <pre><code>
using Microsoft.Maui;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class EditWorkoutPage : ContentPage
{

// REST OF THE CODE

private async void NextEditWorkout_Clicked(object sender, EventArgs e)
    {
        if (BindingContext is Models.Workout workout)
        {
            File.WriteAllText(
                workout.Filename, $&quot;{workout.Name},{workout.ActivityType},{workout.TrainingIntent}&quot;
                );
        }
        await Shell.Current.GoToAsync($&quot;{nameof(SensorConnectionPage)}?{nameof(SensorConnectionPage.ItemId)}={workoutFilename}&quot;);
    }

// REST OF THE CODE

}
          </code></pre>
          <p class="lead">
            Then, we need to define SensorConnectionPage, keeping in mind that
            we are propagating the filename of the workout so that we can save
            it for the insight creation, which happens upon finishing the actual
            exercise. We will be doing it in the same way we did so far through
            QueryProperty, getting and setting the ItemId to the workout
            filename itself upon each screen transition.
          </p>
          <pre><code>
            &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
            &lt;ContentPage
                x:Class=&quot;Project_VeloCity.Views.SensorConnectionPage&quot;
                xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
                xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
                Title=&quot;Connect Sensors&quot;&gt;
            
            &lt;!-- REST OF THE CODE --&gt;
            
                    &lt;Button
                        Grid.Row=&quot;4&quot;
                        BackgroundColor=&quot;{StaticResource Secondary}&quot;
                        BorderWidth=&quot;2&quot;
                        Clicked=&quot;NextSensorButton_Clicked&quot;
                        CornerRadius=&quot;50&quot;
                        FontSize=&quot;45&quot;
                        Text=&quot;Next&quot;
                        TextColor=&quot;{StaticResource Primary}&quot; /&gt;
            
            &lt;!-- REST OF THE CODE --&gt; 
            
            &lt;/ContentPage&gt;  
          </code></pre>

          <pre><code>
            namespace Project_VeloCity.Views;

            [QueryProperty(nameof(ItemId), nameof(ItemId))]
            public partial class SensorConnectionPage : ContentPage
            {
              private string workoutFilename;
            
              public SensorConnectionPage()
              {
                InitializeComponent();
              }
            
                public string ItemId
                {
            
                    set
                    {
                        // Loads value from the query
                        // which is filename of the workout
                        workoutFilename = value;
                    }
                }
            
                private async void NextSensorButton_Clicked(object sender, EventArgs e)
                {
                    await Shell.Current.GoToAsync($&quot;{nameof(ActiveWorkoutPage)}?{nameof(ActiveWorkoutPage.ItemId)}={workoutFilename}&quot;);
                }
            } 
          </code></pre>

          <p class="lead">
            Now we will find ourselves at the ActiveWorkoutPage, which will be
            explained in-depth in its own respective section, while we will now
            shift our focus to checking and selecting saved workouts.
          </p>
          <h4>
            <b><br />Saved Workouts</b>
          </h4>
          <h5>
            <b><br />Viewing List Of Saved Workouts</b>
          </h5>
          <p class="lead">
            The important aspect of the app was to allow users to see the list
            of saved workouts, thereby eliminating the need to recreate workouts
            from scratch each time they want to exercise. We implemented this
            through a model-based approach. Having ObservableCollection of
            workouts and LoadSavedWorkouts method in the SavedWorkouts class
            allowed for seamless fetching of existing workouts and their
            continuous updates in case of any deletions.
          </p>
          <figure class="figure">
            <img
              src="/img/Untitled 5.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Saved wiorkouts User-flow
            </figcaption>
            <br />
            <br />
          </figure>

          <pre><code>
using System.Collections.ObjectModel;
namespace Project_VeloCity.Models;

internal class SavedWorkouts
{

    public ObservableCollection&lt;Workout&gt; Workouts { get; set; } = new ObservableCollection&lt;Workout&gt;();

    public SavedWorkouts()
    {
        LoadSavedWorkouts();
    }

    public void LoadSavedWorkouts()
    {
        Workouts.Clear();

        string appDataPath = FileSystem.AppDataDirectory;

        IEnumerable&lt;Workout&gt; workouts = Directory

                                    .EnumerateFiles(appDataPath, &quot;*.workout.txt&quot;)

                                    .Select(filename =&gt; {
                                        
                                        string[] elements = File.ReadAllText(filename).Split(',');
  
                                        return new Workout()
                                        {
                                            Name = elements[0],
                                            ActivityType = elements[1],
                                            TrainingIntent = elements[2],
                                            Date = File.GetCreationTime(filename),
                                            Filename = filename,
                                        };
                                        }
                                    )
                                    .OrderBy(workout =&gt; workout.Date)
                                    .Reverse().ToList();
        
        foreach (var workout in workouts)
        {
            Workouts.Add(workout);
        }
    }
}            
          </code></pre>
          <p class="lead">
            To effectively display the workouts on the screen we had to define
            user-interface using SavedWorkoutsPage XAML file and its respective
            code behind. We use SavedWorkouts as our binding context, allowing
            for observable collection integration and constant updates. We had
            to develop the design of the UI elements for both empty view and
            item template, as well as smooth animation with brightness change,
            especially useful for users with colour blindness.
          </p>
          <pre><code>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.SavedWorkoutsPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Saved Workouts&quot;&gt;

    &lt;ContentPage.Resources&gt;
        &lt;Style TargetType=&quot;Border&quot;&gt;
            &lt;Setter Property=&quot;VisualStateManager.VisualStateGroups&quot;&gt;
                &lt;VisualStateGroupList&gt;
                    &lt;VisualStateGroup x:Name=&quot;CommonStates&quot;&gt;
                        &lt;VisualState x:Name=&quot;Normal&quot; /&gt;
                        &lt;VisualState x:Name=&quot;Selected&quot;&gt;
                            &lt;VisualState.Setters&gt;
                                &lt;Setter Property=&quot;BackgroundColor&quot; Value=&quot;{StaticResource Secondary}&quot; /&gt;
                            &lt;/VisualState.Setters&gt;
                        &lt;/VisualState&gt;
                    &lt;/VisualStateGroup&gt;
                &lt;/VisualStateGroupList&gt;
            &lt;/Setter&gt;
        &lt;/Style&gt;
    &lt;/ContentPage.Resources&gt;

    &lt;ContentPage.ToolbarItems&gt;
        &lt;ToolbarItem
            Clicked=&quot;AddWorkout_Clicked&quot;
            IconImageSource=&quot;{FontImage Glyph='+',
                                        Color=White,
                                        Size=27}&quot;
            Text=&quot;Add Workout&quot; /&gt;
    &lt;/ContentPage.ToolbarItems&gt;

    &lt;CollectionView
        x:Name=&quot;savedWorkoutsCollection&quot;
        Margin=&quot;20&quot;
        ItemsSource=&quot;{Binding Workouts}&quot;
        SelectionChanged=&quot;SavedWorkoutsCollection_SelectionChanged&quot;
        SelectionMode=&quot;Single&quot;&gt;

        &lt;CollectionView.ItemsLayout&gt;
            &lt;LinearItemsLayout ItemSpacing=&quot;20&quot; Orientation=&quot;Vertical&quot; /&gt;
        &lt;/CollectionView.ItemsLayout&gt;

        &lt;CollectionView.EmptyView&gt;
            &lt;ContentView&gt;
                &lt;Border Stroke=&quot;{StaticResource Secondary}&quot; StrokeThickness=&quot;2&quot;&gt;
                    &lt;Border.StrokeShape&gt;
                        &lt;RoundRectangle CornerRadius=&quot;50&quot; /&gt;
                    &lt;/Border.StrokeShape&gt;
                    &lt;Label
                        FontSize=&quot;24&quot;
                        HorizontalOptions=&quot;Center&quot;
                        Text=&quot;No Saved Workouts&quot;
                        VerticalTextAlignment=&quot;Center&quot; /&gt;
                &lt;/Border&gt;
            &lt;/ContentView&gt;
        &lt;/CollectionView.EmptyView&gt;

        &lt;CollectionView.ItemTemplate&gt;
            &lt;DataTemplate&gt;
                &lt;Border
                    HeightRequest=&quot;150&quot;
                    Stroke=&quot;{StaticResource Secondary}&quot;
                    StrokeThickness=&quot;2&quot;&gt;
                    &lt;Border.StrokeShape&gt;
                        &lt;RoundRectangle CornerRadius=&quot;50&quot; /&gt;
                    &lt;/Border.StrokeShape&gt;
                    &lt;Label
                        FontSize=&quot;32&quot;
                        HorizontalOptions=&quot;Center&quot;
                        Text=&quot;{Binding Name}&quot;
                        VerticalTextAlignment=&quot;Center&quot; /&gt;
                &lt;/Border&gt;
            &lt;/DataTemplate&gt;
        &lt;/CollectionView.ItemTemplate&gt;

    &lt;/CollectionView&gt;

&lt;/ContentPage&gt;
          </code></pre>

          <pre><code>
            namespace Project_VeloCity.Views;

public partial class SavedWorkoutsPage : ContentPage
{
		public SavedWorkoutsPage()
		{
				InitializeComponent();

        BindingContext = new Models.SavedWorkouts();
		}

    protected override void OnAppearing()
    {
        ((Models.SavedWorkouts)BindingContext).LoadSavedWorkouts();
    }

    private async void AddWorkout_Clicked(object sender, EventArgs e)
    {
        await Shell.Current.GoToAsync(nameof(EditWorkoutPage));
    }

    private async void SavedWorkoutsCollection_SelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        if (e.CurrentSelection.Count != 0) 
        { 
            var workout = (Models.Workout)e.CurrentSelection[0];

            await Shell.Current.GoToAsync($&quot;{nameof(EditWorkoutPage)}?{nameof(EditWorkoutPage.ItemId)}={workout.Filename}&quot;);

            savedWorkoutsCollection.SelectedItem = null;
        }
    }
}
          </code></pre>
          <h5><br /><br />Deleting Saved Workout</h5>
          <p class="lead">
            In some cases, the user might have stopped exercising according to a
            certain workout, therefore to mitigate the cluttering of the saved
            workouts page with old workouts, we gave the ability to the user to
            delete those unused with a simple click of a button. The
            EditWorkoutPage XAML code triggers the method in its ode behind
            which finds the file in the app data directory and deletes it,
            removing it from the list of saved workouts as a result. The delete
            button is in the form of a toolbar item in order to save screen
            space, but also since it’s a less frequently encountered in a
            typical use case scenario.
          </p>
          <pre><code>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.EditWorkoutPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;Setup Workout&quot;&gt;

    &lt;ContentPage.ToolbarItems&gt;
        &lt;ToolbarItem
            Clicked=&quot;Delete_Workout&quot;
            IconImageSource=&quot;{FontImage Glyph='DEL',
                                        Color=White,
                                        Size=27}&quot;
            Text=&quot;Delete Workout&quot; /&gt;
    &lt;/ContentPage.ToolbarItems&gt;

   &lt;!-- REST OF THE CODE --&gt;

&lt;/ContentPage&gt;
          </code></pre>
          <pre><code>
using Microsoft.Maui;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class EditWorkoutPage : ContentPage
{

// REST OF THE CODE

    private async void Delete_Workout(object sender, EventArgs e)
    {
        if (BindingContext is Models.Workout workout)
        {
            if (File.Exists(workout.Filename))
            {
                File.Delete(workout.Filename);
            }
        }
        await Shell.Current.GoToAsync("..");
    }

// REST OF THE CODE

} 
          </code></pre>

          <figure class="figure">
            <img
              src="/img/Editing_New_Workout.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Saved wiorkouts User-flow
            </figcaption>
            <br />
            <br />
          </figure>

          <figure class="figure">
            <img
              src="/img/Untitled 6.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Saved wiorkouts User-flow
            </figcaption>
            <br />
            <br />
          </figure>

          <h5><br /><b>Active workout</b></h5>
          <h6><br /><b>Stopwatch of workout time</b></h6>
          <p class="lead">
            Calculation of the workout time is implemented with TimeSpan struct
            in the form of “hour : minute : second”. We update the workout data
            and enable speaker within certain interval, providing immediate
            status for users to adjust their workout intensity.
          </p>
          <h6><br /><b>Display</b></h6>
          <p class="lead">
            The current workout start and update Heart Rate, Cadence values per
            second. The speaker announce instant data values every 5 seconds by
            using <code>Listen()</code>.
          </p>

          <pre><code>
while (isRunning)
{

    currTime = currTime.Add(TimeSpan.FromSeconds(1));
    
    SetTime();
    
    SetHeartRate();

    SetCadence();

    if (currTime.Second % 5 == 0)
    {
        Listen();
    }
    
    await Task.Delay(TimeSpan.FromSeconds(1));

} 
          </code></pre>
          <p class="lead">
            The background of Heart Rate on UI will gradually change from low to
            high opacity along with the increment of heart rate above 120bpm to
            inform the users of Heart Rate intensity.
          </p>
          <pre><code>
private void CheckHeartRate(int rndHR)
{
    double alphacode = (rndHR - 120) * 0.01;
    
    HRBorder.Opacity = alphacode;

    if (alphacode > 0.6)
    {
        HeartRateLabel.TextColor = Colors.Black;
    }
    else
    {
        HeartRateLabel.TextColor = Colors.White;
    }
} 
          </code></pre>

          <p class="lead">
            Border is a .NET MAUI container which can draw border, background
            color for another control, e.g. Label control. Border control is
            used with Heart Rate, Cadence Label control to clearly separate two
            data and better alteration for Heart Rate background color.
          </p>
          <h5><br /><b>Heart Rate & Cadence data</b></h5>
          <p class="lead">
            Both data are displayed on UI and store in insights class per second
            by using <code>AddHRInsight()</code>,
            <code>AddCadenceInsight()</code>. The Insight class store heart rate
            and cadence in type <code>List&lt;int&gt;</code> which are referred…
          </p>
          <pre><code>
private Insight insight;

......

private void AddHRInsight(int heartRate)
    { 
        insight.HeartRateData.Add(heartRate);
    }
          </code></pre>
          <h5><br /><b>Store workout insight</b></h5>
          <p class="lead">
            Each workout information is stored as a string within a
            corresponding file using File.WriteAllText(filename, infoString). To
            view the current workout data, the “End” button is clicked and
            navigate to InsightPage. The ViewModel class is used after to show
            individual insight chart.
          </p>
          <pre><code>
insight.Filename = Path.Combine(appDataPath, randomFileName);
string cadenceDataStr = string.Join(",", insight.CadenceData);
string heartRateDataStr = string.Join(",", insight.HeartRateData);

int hour = currTime.Hour;
int minute = currTime.Minute;
int second = currTime.Second;

File.WriteAllText(
    insight.Filename, 
    $"{insight.WorkoutName}|{insight.WorkoutActivityType}|{insight.WorkoutTrainingIntent}|{hour},{minute},{second}|{heartRateDataStr}|{cadenceDataStr}");

ViewModel.insight = insight;

await Shell.Current.GoToAsync($"{nameof(InsightPage)}?{nameof(InsightPage.ItemId)}={insight.Filename}"); 
          </code></pre>
          <h5>
            <b><br />View Insight</b>
          </h5>
          <p class="lead">
            We choose to display both data in line charts as users can view the
            dynamic of them. The charts are drawn by using MAUI package
            Syncfusion. After passing the current insight to ViewModel, the
            ViewModel will construct two line charts for Heart Rate and Cadence
            data. SensorData objects are created to bind x-axis(second) and
            y-axis(sensor value).
          </p>
          <pre><code>
public class ViewModel
{
    public void SetHeartChart()
    {
        int s = 0;
        foreach (int hr in insight.HeartRateData)
        {
            HeartRate.Add(new SensorData { SensorAtTime = hr, Time = s.ToString() });
            s += 1;
        }
    }
}

public class SensorData
{
    public int SensorAtTime { get; set; }
    public string Time { get; set; }
} 
          </code></pre>
          <p class="lead">
            We only calculate data insights (average, minimum, maximum) on
            InsightPage.xmal.cs after initialize insight page. Also, a part,
            Heart Rate overview, provides the intensity level of current workout
            by using the definition of heart rate zo
          </p>
          <pre><code>
private void CalHRZone()
{
    HRzones = new List&lt;double&gt;()
        {
            HRReserve * 0.5 + restHR, //zone 1: 50% ~ 60%
            HRReserve * 0.6 + restHR, //zone 2: 60% ~ 70%
            HRReserve * 0.7 + restHR,
            HRReserve * 0.8 + restHR,
            HRReserve * 0.9 + restHR,
        };
}
</code></pre>

          <p class="lead">
            The InsightPage is implemented using ScrollView in .Net Maui.
            Average, minimum & maximum, charts are showed in separate rows with
            two Grid view for Heart Rate and Cadence. RowDefinition Height
            differ in both Grid view as different distance is needed to display
            data properly. “Done” button on the end of the ScrollView and “DEL”
            button on the top right will finish viewing or delete current
            insight, and navigate back to Home page.
          </p>
          <pre><code>
private async void Delete_Insight(object sender, EventArgs e)
    {
        if (File.Exists(insight.Filename))
        {
            File.Delete(insight.Filename);
        }

        await Shell.Current.Navigation.PopToRootAsync();

    }

private async void DoneButton_Clicked(object sender, EventArgs e)
    {
        await Shell.Current.Navigation.PopToRootAsync();
    } 
          </code></pre>

          <figure class="figure">
            <img
              src="/img/Screenshot_20230325_111650_(1).jpg"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Graph showing Heart Rate(bpm) during a workout
            </figcaption>
            <br />
            <br />
          </figure>
          <h5><br /><b>Insights</b></h5>
          <p class="lead">
            Insights are the very important aspect of our app, they are core
            structure which allows users to save the data connected to their
            finished exercises and get the useful feedback around it. They
            include all of the information connected to the performance of the
            user, allowing feedback driven approach towards accomplishing the
            desired fitness goals. They are represented as objects, adhering to
            the structure of the Insight class, which classifies as a Model in
            our system architecture diagram.
          </p>
          <figure class="figure">
            <img
              src="/img/Untitled 1 (2).png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Insight class classification in the system architecture diagram
            </figcaption>
            <br />
            <br />
          </figure>

          <pre><code>
namespace Project_VeloCity.Models;

public class Insight
{
    public List&lt;int&gt; HeartRateData;
    public List&lt;int&gt; CadenceData;
    public Insight() 
    {
        HeartRateData = new();
        CadenceData = new();
    }
    public Insight(string fileName)
    {
        HeartRateData = new();
        CadenceData = new();

        Filename = fileName;

        if (File.Exists(Filename))
        {
            string[] elements = File.ReadAllText(Filename).Split('|');
            WorkoutName = elements[0];
            WorkoutActivityType = elements[1];
            WorkoutTrainingIntent = elements[2];
            List&lt;int&gt; timeLst = elements[3].Split(',').Select(int.Parse).ToList();
            Duration = new(timeLst[0], timeLst[1], timeLst[2]);
            HeartRateData = elements[4].Split(',').Select(int.Parse).ToList();
            CadenceData = elements[5].Split(',').Select(int.Parse).ToList();
            Date = File.GetCreationTime(Filename);
        }
    }
    public string Filename { get; set; }
    public DateTime Date { get; set; }
    public string WorkoutName { get; set; }
    public string WorkoutActivityType { get; set; }
    public string WorkoutTrainingIntent { get; set; }
    public TimeOnly Duration { get; set; }

} 
          </code></pre>
          <h5><br /><b>Reviewing Workout Performance History</b></h5>
          <p class="lead">
            Upon choosing the insights tab, user can review the average data
            obtained from all previous workout sessions. In addition to
            scrolling through all of them, the user can check their specifics
            accordingly. For this, we created the SavedInsightsPage XAML file
            which contains the collection of all the exercises and their total
            average. This is done through SavedInsightsPage code behind which
            calls the respective methods from the SavedInsights class and
            changes the data for the XAML file as needed.
          </p>

          <figure class="figure">
            <img
              src="/img/Untitled 7.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Insights User-Flow
            </figcaption>
            <br />
            <br />
          </figure>
          <pre><code>
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
namespace Project_VeloCity.Models;

internal class SavedInsights
{
    public ObservableCollection&lt;Insight&gt; Insights { get; set; } = new ObservableCollection&lt;Insight&gt;();

    public SavedInsights()
    {
        LoadSavedInsights();
    }

    public List&lt;string&gt; LoadSavedInsights()
    {
        Insights.Clear();
        string appDataPath = FileSystem.AppDataDirectory;
        IEnumerable&lt;Insight&gt; insights = Directory

                                    .EnumerateFiles(appDataPath, &quot;*.insight.txt&quot;)
                                    .Select(filename =&gt; {
                                        return new Insight(filename);
                                    }
                                    )
                                    .OrderBy(insight =&gt; insight.Date)
                                    .Reverse().ToList();
        foreach (var insight in insights)
        {
            Insights.Add(insight);
        }
        return LoadAverages();
    } 

    public List&lt;string&gt; LoadAverages()
    {
        List&lt;string&gt; lst = new List&lt;string&gt;();
        lst.Add(&quot;0&quot;);
        lst.Add(&quot;0&quot;);
        lst.Add(&quot;0&quot;);
        if (Insights.Count &gt; 0)
        {
            Insight insight = Insights[0];
            double averageHeartRate = getAverageSensor(insight.HeartRateData);
            double averageCadence = getAverageSensor(insight.CadenceData);
            long averageDuration = insight.Duration.Ticks;

            for (int i = 1; i &lt; Insights.Count; i++)
            {
                insight = Insights[i];
                averageHeartRate = (averageHeartRate + getAverageSensor(insight.HeartRateData)) / 2;
                averageCadence = (averageCadence + getAverageSensor(insight.CadenceData)) / 2;
                averageDuration = (averageDuration + insight.Duration.Ticks) / 2;
            }
            lst[0] = ($&quot;{(long)averageHeartRate}&quot;);
            lst[1] = ($&quot;{(long)averageCadence}&quot;);
            lst[2] = ($&quot;{(long)averageDuration}&quot;);
        }
        return lst;
    }

    private double getAverageSensor(List&lt;int&gt; data)
    {
        return data.Count &gt; 0 ? data.Average() : 0.0;
    }
} 
          </code></pre>
          <pre><code>
            &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;ContentPage
    x:Class=&quot;Project_VeloCity.Views.SavedInsightsPage&quot;
    xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;
    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;
    Title=&quot;All Insights&quot;&gt;
	  
		&lt;!-- REST OF THE CODE--&gt;

        &lt;CollectionView
            x:Name=&quot;savedInsightsCollection&quot;
            Grid.Row=&quot;3&quot;
            Margin=&quot;20&quot;
            ItemsSource=&quot;{Binding Insights}&quot;
            SelectionChanged=&quot;SavedInsightsCollection_SelectionChanged&quot;
            SelectionMode=&quot;Single&quot;&gt;

            &lt;CollectionView.ItemsLayout&gt;
                &lt;LinearItemsLayout ItemSpacing=&quot;20&quot; Orientation=&quot;Vertical&quot; /&gt;
            &lt;/CollectionView.ItemsLayout&gt;

            &lt;CollectionView.EmptyView&gt;
                &lt;ContentView&gt;
                    &lt;Border Stroke=&quot;{StaticResource Secondary}&quot; StrokeThickness=&quot;2&quot;&gt;
                        &lt;Border.StrokeShape&gt;
                            &lt;RoundRectangle CornerRadius=&quot;50&quot; /&gt;
                        &lt;/Border.StrokeShape&gt;
                        &lt;Label
                            FontSize=&quot;24&quot;
                            HorizontalOptions=&quot;Center&quot;
                            Text=&quot;No Saved Insights&quot;
                            VerticalTextAlignment=&quot;Center&quot; /&gt;
                    &lt;/Border&gt;
                &lt;/ContentView&gt;
            &lt;/CollectionView.EmptyView&gt;

            &lt;CollectionView.ItemTemplate&gt;
                &lt;DataTemplate&gt;
                    &lt;Border
                        HeightRequest=&quot;250&quot;
                        Stroke=&quot;{StaticResource Secondary}&quot;
                        StrokeThickness=&quot;2&quot;&gt;
                        &lt;Border.StrokeShape&gt;
                            &lt;RoundRectangle CornerRadius=&quot;50&quot; /&gt;
                        &lt;/Border.StrokeShape&gt;

                        &lt;Grid RowDefinitions=&quot;*,*,*&quot;&gt;

                            &lt;Label
                                Margin=&quot;0,25,0,0&quot;
                                FontSize=&quot;32&quot;
                                HorizontalOptions=&quot;Center&quot;
                                Text=&quot;{Binding WorkoutName}&quot;
                                VerticalTextAlignment=&quot;Center&quot; /&gt;

                            &lt;Grid
                                Grid.Row=&quot;1&quot;
                                Margin=&quot;0,0&quot;
                                ColumnDefinitions=&quot;*,*&quot;
                                HeightRequest=&quot;50&quot;&gt;
                                &lt;Label
                                    FontSize=&quot;23&quot;
                                    HorizontalOptions=&quot;Center&quot;
                                    Text=&quot;{Binding WorkoutActivityType}&quot;
                                    TextColor=&quot;#30e5d0&quot; /&gt;
                                &lt;Label
                                    Grid.Column=&quot;1&quot;
                                    FontSize=&quot;23&quot;
                                    HorizontalOptions=&quot;Center&quot;
                                    Text=&quot;{Binding WorkoutTrainingIntent}&quot;
                                    TextColor=&quot;#30e5d0&quot; /&gt;
                                &lt;BoxView
                                    Grid.ColumnSpan=&quot;2&quot;
                                    HeightRequest=&quot;2&quot;
                                    HorizontalOptions=&quot;Fill&quot;
                                    Opacity=&quot;1&quot;
                                    VerticalOptions=&quot;End&quot;
                                    Color=&quot;#30e5d0&quot; /&gt;
                            &lt;/Grid&gt;

                            &lt;Label
                                Grid.Row=&quot;2&quot;
                                Margin=&quot;0,0,0,30&quot;
                                FontSize=&quot;23&quot;
                                HorizontalOptions=&quot;Center&quot;
                                Text=&quot;{Binding Date}&quot;
                                VerticalTextAlignment=&quot;Center&quot; /&gt;

                        &lt;/Grid&gt;

                    &lt;/Border&gt;
                &lt;/DataTemplate&gt;
            &lt;/CollectionView.ItemTemplate&gt;
        &lt;/CollectionView&gt;
	   
	&lt;!-- REST OF THE CODE--&gt;

&lt;/ContentPage&gt;
          </code></pre>
          <pre><code>
using Project_VeloCity.Models;
namespace Project_VeloCity.Views;

public partial class SavedInsightsPage : ContentPage
{

    public SavedInsightsPage()
    {
        InitializeComponent();
        BindingContext = new SavedInsights();
    }
    
    protected override void OnAppearing()
    {
        List&lt;string&gt; sensorsAndDuration = ((SavedInsights)BindingContext).LoadSavedInsights();    
        HeartRateLabel.Text = sensorsAndDuration[0];
        CadenceLabel.Text = sensorsAndDuration[1];
        TimeOnly currTime = new TimeOnly(long.Parse(sensorsAndDuration[2]));
        DurationLabel.Text = $&quot;{currTime.Hour:00}:{currTime.Minute:00}:{currTime.Second:00}&quot;;

    }

    private async void SavedInsightsCollection_SelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        if (e.CurrentSelection.Count != 0)
        {
            var insight = (Insight)e.CurrentSelection[0];
            ViewModel.insight = insight;
            await Shell.Current.GoToAsync($&quot;{nameof(InsightPage)}?{nameof(InsightPage.ItemId)}={insight.Filename}&quot;);
            savedInsightsCollection.SelectedItem = null;
        }
    }
} 
          </code></pre>
          <h5><br /><b>Text-To-Speech</b></h5>
          <i>Ramon will ad</i>

          <figure class="figure">
            <img
              src="/img/Untitled 8.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Text-To-Speech classification in the system architecture diagram
            </figcaption>
            <br />
            <br />
          </figure>

          <h5><br /><b>Speech Recognition</b></h5>
          <figure class="figure">
            <img
              src="/img/Untitled 9.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Speech Recognition classification in the system architecture
              diagram
            </figcaption>
            <br />
            <br />
          </figure>
          <p class="lead">
            This part was especially useful for implementing the virtual coach.
            Thanks to the team at .NET MAUI, especially the Senior Software
            Engineer for its development Gerald Versluis, we were able to adapt
            the potential future plugin for the use case of our app. It uses
            platform specific integration, the android speech recognition
            service. The implementation consists of a Listener which implements
            the IRecognitionListener and ISpeechToText interface which
            encapsulates the main functionalities and provides a future-proof
            design for implementations in other platforms.
          </p>

          <pre><code>
public interface ISpeechToText
{
    Task&lt;bool&gt; RequestPermissions();

    Task&lt;string&gt; Listen(CultureInfo culture,
        IProgress&lt;string&gt; recognitionResult,
        CancellationToken cancellationToken);
} 
          </code></pre>
          <p class="lead">
            The android specific implementation, which we used in our case
            implements these methods and using the SpeechRecognitionListener
            methods gets the recognised text
          </p>
          <pre><code>
public class SpeechToTextImplementation : ISpeechToText
{
    private SpeechRecognitionListener listener;
    private SpeechRecognizer speechRecognizer;

    public async Task&lt;string&gt; Listen(CultureInfo culture, IProgress&lt;string&gt; recognitionResult, CancellationToken cancellationToken)
    {
        var taskResult = new TaskCompletionSource&lt;string&gt;();
        listener = new SpeechRecognitionListener
        {
            Error = ex =&gt; taskResult.TrySetException(new Exception(&quot;Failure in speech engine - &quot; + ex)),
            PartialResults = sentence =&gt;
            {
                recognitionResult?.Report(sentence);
            },
            Results = sentence =&gt; taskResult.TrySetResult(sentence)
        };
      
        // ... REST OF THE CODE
}  
          </code></pre>
          <h5><br /><b>Virtual Coach (STT-TTS Integration)</b></h5>
          <p class="lead">
            Makes use of both Speech Recognition (Speech-To-Text) and
            Text-To-Speech to achieve seamless two-way communication between the
            user and the virtual coach. Imporant feature of it, is that it’s
            adaptable and future-proof. Simple interface for adding more
            instructions and functionalities will allow the app to not degrade,
            but improve over time using the feedback and wishes from the users.
            It’s implemented by combining the two APIs during active workouts.
          </p>
          <figure class="figure">
            <img
              src="/img/Untitled 10.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Virtual Coach classification in the system architecture diagram
            </figcaption>
            <br />
            <br />
          </figure>
          <p class="lead">
            It has been implemented by repeatedly initiating the listening
            operation every 5 seconds, therefore producing the effect of
            continuous listening without imposing the need for additional
            memory. Being able to periodically check for the input from the
            user, without the unnecessary consumption of large amount of data is
            something that really makes this implementation powerful for the
            specific requirements of the fitness tracking application like ours.
          </p>
          <figure class="figure">
            <img
              src="/img/Active_Workout_Sequence.png"
              class="figure-img img-fluid rounded"
            />
            <figcaption class="figure-caption text-center">
              Sequence Diagram of Virtual Coach Feature in Active Workout
            </figcaption>
            <br />
            <br />
          </figure>
          <pre><code>
using Project_VeloCity.Models;
using Project_VeloCity.ViewModels;
using System.Globalization;
namespace Project_VeloCity.Views;

[QueryProperty(nameof(ItemId), nameof(ItemId))]
public partial class ActiveWorkoutPage : ContentPage
{

// REST PF THE CODE
    private async void Listen()
    {
        var isAuthorized = await speechToText.RequestPermissions();
        if (isAuthorized)
        {
            try
            {
                RecognitionText = await speechToText.Listen(CultureInfo.GetCultureInfo(&quot;en-us&quot;),
                    new Progress&lt;string&gt;(partialText =&gt;
                    {
                        RecognitionText = partialText;
                        OnPropertyChanged(nameof(RecognitionText));
                    }), tokenSource.Token);

                // checking recognized text
                CheckForKeyword(RecognitionText);

            }

          // ... REST OF THE CODE
    }
    

    // REST OF THE CODE

    private async void CheckForKeyword(string sentenceToCheck)
    {

        if (sentenceToCheck.Contains(&quot;heart rate&quot;))
        {
            await TextToSpeech.SpeakAsync($&quot;It is {HeartRateLabel.Text} beats per minute.&quot;);
        }
        else if (sentenceToCheck.Contains(&quot;cadence&quot;))
        {
            await TextToSpeech.SpeakAsync($&quot;It is {CadenceLabel.Text} rpm.&quot;);
        }
        else if (sentenceToCheck.Contains(&quot;information&quot;))
        {
            await TextToSpeech.SpeakAsync($&quot;{HeartRateLabel.Text} beats per minute with {CadenceLabel.Text} rpm.&quot;);
        }
        else if (sentenceToCheck.Contains(&quot;motivation&quot;))
        {
            await TextToSpeech.SpeakAsync($&quot;You are doing great, keep it up.&quot;);
        }
  }

  // REST OF THE CODE 
          </code></pre>
        </div>
      </div>
    </section>

    <section class="p-5">
      <div class="container aos-init aos-animate" data-aos="fade-up">
        <div class="row justify-content-center mb-4">
          <h3 class="text-center"><br />Bluetooth Implementation</h3>
          <h4>
            <b><br />Tools and Dependencies</b>
          </h4>
          <div class="row">
            <div class="d-flex justify-content-center">
              <img
                src="img/png-transparent-xamarin-mobile-app-development-native-net-framework-c-android-blue-angle-calendar-removebg-preview.png"
                class="tech"
              />
              <img src="img/shadow-removebg-preview.png" class="tech" />
              <img src="img/Csharp_Logo.png" class="tech" />
              <img
                src="img/radial-icon-set-2-bluetooth-bluetooth-icon-png-clipart-thumbnail-removebg-preview.png"
                class="tech"
              />
            </div>
          </div>
          <h4>
            <b><br />Algorithm walkthrough</b>
          </h4>
          <h5>
            <b><br />Checking and Requesting Permissions</b>
          </h5>
          <p class="lead">
            In order to scan, discover and connect to BLE devices, one must ask
            for bluetooth & location permissions from the target device.
            PermissionsStatus is a Permissions class that allows the app to
            check and request permissions at run time, it is required for the
            functioning of this app.
          </p>
          <pre><code>
                      public async Task&lt;PermissionStatus&gt; RequestBluetoothPermissions()
                        {
                            PermissionStatus status = PermissionStatus.Unknown;
                            try
                            {
                                status = await Permissions.RequestAsync&lt;BluetoothPermissions&gt;();
                            }
                    #if permission is denied an exception is caught
                            catch (Exception ex)
                            {
                                Console.WriteLine($&quot;Unable to request Bluetooth LE permissions: {ex.Message}.&quot;);
                                await Shell.Current.DisplayAlert($&quot;Unable to request Bluetooth LE permissions&quot;, $&quot;{ex.Message}.&quot;, &quot;OK&quot;);
                            }
                            return status
                    </code></pre>
          <p class="lead">
            Check whether bluetooth permissions have been granted
          </p>
          <pre><code>
        PermissionStatus permissionStatus = await BluetoothLEService.CheckBluetoothPermissions();
        if(permissionStatus != PermissionStatus.Granted)
        {
            permissionStatus = await BluetoothLEService.RequestBluetoothPermissions();
            if(permissionStatus != PermissionStatus.Granted)
            {
                await Shell.Current.DisplayAlert($"Bluetooth LE permissions", $"Bluetooth LE permissions are not granted.", "OK");
                return;
            }
        }
                    </code></pre>
          <p class="lead">
            Check whether bluetooth is one & available on the device
          </p>
          <pre><code>
                     if (!BluetoothLEService.BluetoothLE.IsAvailable || BluetoothLEService.BluetoothLE.State != BluetoothState.On)
        {
            Console.WriteLine($"Bluetooth is missing.");
            await Shell.Current.DisplayAlert($"Bluetooth", $"Bluetooth is missing.", "OK");
            return;
        }
try
        {
            if (!BluetoothLEService.BluetoothLE.IsOn)
            {
                await Shell.Current.DisplayAlert($"Bluetooth is not on", $"Please turn Bluetooth on and try again.", "OK");
                return;
            }
                    </code></pre>
          <h5>
            <b><br />Starting scan</b>
          </h5>
          <p class="lead">
            Once the permissions have been accepted, the app can start
            scanning<br />
            <i>deviceCandidates</i> represents the list of devices that have
            been discovered by the
            <i>BluetoothLEService.ScanForDevicesAsync()</i>
          </p>
          <pre><code>
                        List&lt;DeviceCandidate&gt; deviceCandidates = await BluetoothLEService.ScanForDevicesAsync();
                      </code></pre>
          <p class="lead">System will scan for 4 seconds before timing out</p>
          <pre><code>
                        BluetoothLE = CrossBluetoothLE.Current;
                        Adapater = CrossBluetoothLE.Current.Adapater;
                        Adapter.ScanTimeout = 4000; //ms
                      </code></pre>
          <div class="row">
            <div class="d-flex justify-content-center mb-3">
              <img src="img/sun.png" class="img-fluid shadow-sm" />
            </div>
          </div>
          <p class="lead">
            If sensors/BLE devices are found the deviceCandidate list will be
            represented here as a grid of devices with each row being each
            devices name and Guid (global unique identifier)
          </p>
          <br />
          <pre><code>
                          &lt;DataTemplate x:DataType=&quot;model:DeviceCandidate&quot;&gt;
                          &lt;Grid Padding=&quot;10&quot;&gt;
                              &lt;Frame BorderColor=&quot;#DDDDDD&quot;
                                     HasShadow=&quot;True&quot;
                                     Padding=&quot;10&quot;
                                     Background=&quot;Black&quot;
                                     CornerRadius=&quot;10&quot;
                                     IsClippedToBounds=&quot;True&quot;&gt;
                          &lt;VerticalStackLayout Padding=&quot;8&quot;&gt;
                              &lt;Label Style=&quot;{StaticResource BaseLabel}&quot; Text=&quot;{Binding Name}&quot; /&gt;
                               &lt;Label Style=&quot;{StaticResource MicroLabel}&quot; Text=&quot;{Binding Id}&quot; /&gt;
                          &lt;/VerticalStackLayout&gt;
                              &lt;/Frame&gt;
                           &lt;/Grid&gt;
                        </code></pre>
          <p class="lead">
            Once a sensor has been selected it will navigate to its
            correspondoning page (Heart/Sensor) and you will be given the
            ability to connect/disconnect (see above)
          </p>

          <h5>
            <b><br />Connectig to a device</b>
          </h5>
          <p class="lead">
            The adapter will connect to a device given a known global user
            identifier (Guid) which is extracted from
            BluetoothLSEService.NewDeviceCandidateFromHomePage.Id
          </p>
          <pre><code>
BluetoothLSEService.Device = await 
BluetoothLSEService.Adapter.ConnectToKnownDeviceAsync(BluetoothLSEService.NewDeviceCandidateFromHomePage.Id);
                      </code></pre>
          <h5>
            <b><br />Disconnecting from a device </b>
          </h5>
          <p class="lead">
            Like before, the adapter will disconnect from a device given a known
            device name which is extracted from BluetoothLSEService.Device
          </p>
          <pre><code>
await BluetoothLSEService.Adapter.DisconnectDeviceAsync(BluetoothLSEService.Device);
                      </code></pre>
          <h5>
            <b><br />Getting characteristics</b>
          </h5>
          <p class="lead">
            Once a connection has been made, the system can extract specific
            characterisitcs from the BLE device given general identifiers. Below
            are our full list of Guids stored in class HeartRateIdentifiers
          </p>
          <pre><code>
class HeartRateIdentifiers

    {
    // primary service for heart rate 8CE5CC02-0A4D-11E9-AB14-D663BD873D93"
    //public static Guid HeartRateService = Guid.ParseExact("0000180d-0000-1000-8000-00805f9b34fb", "d");
    public static Guid[] HeartRateServiceUuids { get; private set; } = new Guid[] { new Guid("0000180d-0000-1000-8000-00805f9b34fb") }; //"Heart Rate Service"
    public static Guid HeartRateServiceUuid { get; private set; } = new Guid("0000180d-0000-1000-8000-00805f9b34fb"); //"Heart Rate Service"
    public static Guid HeartRateMeasurementCharacteristicUuid { get; private set; } = new Guid("00002a37-0000-1000-8000-00805f9b34fb"); //"Heart Rate Measurement"
    public static Guid BatteryLevelServiceUuid { get; private set; } = new Guid("0000180f-0000-1000-8000-00805f9b34fb"); //"Battery Service"
    public static Guid BatteryLevelCharacteristicUuid { get; private set; } = new Guid("00002a19-0000-1000-8000-00805f9b34fb"); //"Battery Level"
    }
                      </code></pre>
          <p class="lead">
            Heart rate information being extracted from heart sensor with
            provided characteristic Guids
          </p>
          <pre><code>
 HeartRateMeasurementCharacteristic = await HeartRateService.GetCharacteristicAsync(HeartRateIdentifiers.HeartRateMeasurementCharacteristicUuid);
                      </code></pre>
          <p class="lead">
            Given the heart rate updates throughout the workout, system must
            continously extract heart rate information from the sensor as long
            as there is a stable connection
          </p>
          <pre><code>
                        if (HeartRateMeasurementCharacteristic.CanUpdate)
                        {
                            Title = $"{BluetoothLSEService.Device.Name}";

                            #region save device id to storage
                            await SecureStorage.Default.SetAsync("device_name", $"{BluetoothLSEService.Device.Name}");
                            await SecureStorage.Default.SetAsync("device_id", $"{BluetoothLSEService.Device.Id}");
                            #endregion save device id to storage

                            HeartRateMeasurementCharacteristic.ValueUpdated += HeartRateMeasurementCharacteristic_ValueUpdated;
                            await HeartRateMeasurementCharacteristic.StartUpdatesAsync();
                        } 
                      </code></pre>
        </div>
      </div>
    </section>

    <!--Footer-->

    <section class="footer">
      <div class="social-links">
        <a href="https://github.com/BaneTrajkovic/Project-VeloCity"
          ><i class="fa-brands fa-github"></i
        ></a>
        <a href="https://projectvelocity2023.wordpress.com/"
          ><i class="fa-brands fa-wordpress"></i
        ></a>
      </div>

      <ul class="list">
        <li class="nav-item">
          <a href="/index.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item">
          <a href="/lit.html" class="nav-link">Research</a>
        </li>
        <li class="nav-item">
          <a href="/hci.html" class="nav-link">HCi</a>
        </li>
        <li class="nav-item">
          <a href="/requirements.html" class="nav-link">Requirements</a>
        </li>
        <li class="nav-item">
          <a href="/implementation.html" class="nav-link">Implementation</a>
        </li>
        <li class="nav-item">
          <a href="/requirements.html" class="nav-link">Requirements</a>
        </li>
        <li class="nav-item">
          <a href="/ui.html" class="nav-link">Sys.Design</a>
        </li>
        <li class="nav-item">
          <a href="/system.html" class="nav-link">UI Design</a>
        </li>
        <li class="nav-item">
          <a href="/evaluation.html" class="nav-link">Testing</a>
        </li>
        <li class="nav-item">
          <a href="/appendix.html" class="nav-link">Appendix</a>
        </li>
      </ul>
      <p class="copyright">2023 All Rights Reserved</p>
    </section>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();
    </script>
  </body>
</html>
